<div class="dashboard-content-right">
  <div class="w100">
    <div class="dashboard-post-profile-btn">
    </div>
  </div>
  <!--dashboard-post-profile-btn ends-->
  <div class="dashboard-content">
    <h1>Resumes</h1>
    <%= image_tag asset_path 'dashboard-botom-line.png' %>

    <button id="upload-popup" class="question-button">Upload a New CV</button>

    <p><br/>
    </p>

    <h1>My<span class="red"> Resumes</span></h1>
    <%= image_tag asset_path 'dashboard-botom-line.png' %>
    <% unless @resumes.blank? %>
        <p>Total Number of resumes <%= @resumes.count %></p>
        <table>
          <tr>
            <th>Resume Name</th>
            <th>File Type</th>
            <th> Action |</th>
            <th> Publish</th>
            <!--<th>Download</th>-->
          </tr>

          <% @resumes.each do |resume| %>
              <tr>
                <td><%= resume.photo_file_name %></td>
                <td><%= resume.photo_content_type %></td>
                <td><%= link_to "Delete", delete_cv_job_seeker_index_path(:id => resume.id), :class => "delete_cv" %></td>
                <td> <%= radio_button_tag "cv_id", resume.id,resume.is_publishable , :onchange => "select_cv('#{resume.id}')" %></td>

              </tr>
          <% end %>
        </table>
    <% else %>
        <p><span>Currently No Resume Present!</span></p>
    <% end %>
  </div>
  <div id="upload-form" title="Upload a New CV ">

    <%= form_for :cv, :url => { :action => 'new_resume' }, :html => { :id => 'add_cv_form' }, :remote => true do |f| %>
        <div class="select-holder">
          <%= f.file_field :photo %>

        </div>
    <% end %>
  </div>
</div>



<script language="JavaScript">
    $("#upload-form").dialog({
        autoOpen:false,
        height:300,
        width:350,
        modal:true,
        buttons:{

            Cancel:function () {
                $(this).dialog("close");
            },
            "Upload a New Cv":function () {
                $('#add_cv_form').ajaxSubmit({
                    beforeSubmit:function (a, f, o) {
                        o.dataType = 'json';
                    },
                    success:function (data) {

                        $(".dashboard-content-right").html(data.html);
                    }
                });

                $("#upload-form").dialog("close");

            }}
    });

    $("#upload-popup").click(function () {
        <%unless current_user.profile.blank?%>
        {
        <%if @resumes.count != 3%>
            {
                $("#upload-form").dialog("open");
            }
        <%else%>
            {
                alert("You are allowed to upload three resumes");
            }
        <%end%>
        }
        <%else%>
        {
            alert("Please first create a profile!");

        }

        <%end%>
    });


    $("a.delete_cv").click(function () {
        $.ajax({
            context:this,
            url:$(this).attr("href"),
            type:"GET",
            data:$(this).serialize(),
            dataType:"json",
            success:function (response) {
                return $(".dashboard-content-right").html(response.html);
            }
        });
        return false;
    });

    function select_cv(resume_id) {

        url = "/job_seeker/make_cv_publishable?id=" + resume_id;
        $.ajax({
            context:this,
            url:url,
            type:"GET",
            data:$(this).serialize(),
            dataType:"json",
            success:function (response) {
                $(".dashboard-content-right").html(response.html);
            }
        });
    }


</script>